<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Browser Bundle Test</title>
</head>
<body>
  <h1>Browser Bundle Test Page</h1>
  <div id="status">Loading...</div>
  <canvas id="canvas" style="display: none;"></canvas>

  <script type="module">
    // Import from the built browser bundle
    import { genQrImage } from '/dist/browser.mjs';

    // Expose functions to Playwright
    window.testBrowserBundle = {
      async generateQR(input, options = {}) {
        try {
          return await genQrImage(input, options);
        } catch (error) {
          throw new Error(`Failed to generate QR: ${error.message}`);
        }
      },

      async generateSVG(input, options = {}) {
        return await genQrImage(input, {
          ...options,
          output: { format: 'svg', type: 'string' }
        });
      },

      async generatePNGDataURL(input, options = {}) {
        return await genQrImage(input, {
          ...options,
          size: options.size || 1000,
          output: { format: 'png', type: 'dataURL' }
        });
      },

      async generatePNGBuffer(input, options = {}) {
        const dataURL = await this.generatePNGDataURL(input, options);
        // Convert dataURL to Uint8Array
        const base64 = dataURL.split(',')[1];
        const binaryString = atob(base64);
        const bytes = new Uint8Array(binaryString.length);
        for (let i = 0; i < binaryString.length; i++) {
          bytes[i] = binaryString.charCodeAt(i);
        }
        return Array.from(bytes); // Return as regular array for JSON serialization
      },

      // Test helper: verify Canvas API is available
      hasCanvas() {
        return typeof HTMLCanvasElement !== 'undefined' && 
               typeof CanvasRenderingContext2D !== 'undefined';
      }
    };

    // Update status
    document.getElementById('status').textContent = 'Ready';
    console.log('Browser bundle loaded successfully');
  </script>
</body>
</html>
